<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short Tutorial ‚Ä¢ valiCATE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Short Tutorial">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">valiCATE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/valiCATE-short-tutorial.html">Short Tutorial</a>
</li>
<li>
  <a href="../articles/denoising.html">Denoising</a>
</li>
<li>
  <a href="../articles/hypotheses-testing.html">Hypotheses Testing</a>
</li>
<li>
  <a href="../articles/more-on-plotting.html">More on Plotting</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/riccardo-df/valiCATE" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Short Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/riccardo-df/evaluCATE/blob/main/vignettes/valiCATE-short-tutorial.Rmd" class="external-link"><code>vignettes/valiCATE-short-tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>valiCATE-short-tutorial.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we show how to use the <code>valiCATE</code>
package to validate machine learning models for the conditional average
treatment effects (CATEs).</p>
<p>Before diving in the technical details, we need to define
notation:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
‚Üí Observed outcome;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>i</mi></msub><mo>‚àà</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">D_i \in \{ 0, 1\}</annotation></semantics></math>
‚Üí Treatment indicator;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
‚Üí Covariate vector;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mu ( X_i ) := \mathbb{E} [ Y_i | X_i ]</annotation></semantics></math>
‚Üí Conditional mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mo>,</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>D</mi><mi>i</mi></msub><mo>=</mo><mi>d</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mu (d, X_i ) := \mathbb{E} [ Y_i | X_i, D_i = d ]</annotation></semantics></math>
‚Üí Conditional mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
for subgroup
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>i</mi></msub><mo>=</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">D_i = d</annotation></semantics></math>;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>‚Ñô</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>D</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">p ( X_i ) := \mathbb{P} [ D_i = 1 | X_i ]</annotation></semantics></math>
‚Üí Propensity score;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mfrac><mn>1</mn><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">w ( X_i ) := \frac{1}{p ( X_i ) [ 1 - p ( X_i )]}</annotation></semantics></math>
‚Üí Propensity score weights;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>i</mi></msub><mo>:=</mo><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">H_i := w ( X_i ) [ D_i - p (X_i) ]</annotation></semantics></math>
‚Üí Horvitz-Thompson operator;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œì</mi><mi>i</mi></msub><mo>:=</mo><msub><mi>Œº</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Œº</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mfrac><mrow><msub><mi>D</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>‚àí</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>‚àí</mo><msub><mi>D</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\Gamma_i := \mu_1 ( X_i ) - \mu_0 ( X_i ) + \frac{D_i [ Y_i - \mu_1 ( X_i ) ]}{p ( X_i )} - \frac{[ 1 - D_i ] [ Y_i - \mu_0 ( X_i ) ]}{1 - p ( X_i )}</annotation></semantics></math>
‚Üí Doubly-robust (or AIPW) score;</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÑ</mi><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\tau := \mathbb{E} [ Y_i ( 1 ) - Y_i ( 0 ) ]</annotation></semantics></math>
‚Üí Average treatment effect (ATE);</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\tau ( X_i ) := \mathbb{E} [ Y_i ( 1 ) - Y_i ( 0 ) | X_i ]</annotation></semantics></math>
‚Üí CATE.</li>
</ul>
<p>Throughout the rest of the tutorial, we assume SUTVA and a randomized
treatment assignment.</p>
<div class="section level2">
<h2 id="motivating-example">Motivating Example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<p>We illustrate the usage of the <code>valiCATE</code> package with
simulated data:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>‚àº</mo><mi>ùí∞</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_{i} \sim \mathcal{U} ( 0, 1 )</annotation></semantics></math>
single uniformly distributed covariate;</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>i</mi></msub><mo>‚àº</mo><mi>B</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>o</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.4</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">D_i \sim Bernoulli(0.4)</annotation></semantics></math>
randomly assigned treatment;</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>X</mi><mi>i</mi></msub><mo>+</mo><mn>0</mn><mo>√ó</mo><msub><mi>D</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y_i = X_i + 0 \times D_i + \varepsilon_i</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œµ</mi><mi>i</mi></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\varepsilon_i \sim \mathcal{N} ( 0, 5 )</annotation></semantics></math>;</p></li>
</ul>
<p>This implies a homogeneous zero effect,
i.e.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\tau ( X_i ) = 0</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">mu0</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To achieve valid inference, we randomly <strong>partition our data
set</strong> into two subsamples:</p>
<ol style="list-style-type: decimal">
<li><p>a <em>training sample</em> for estimating the CATEs, and</p></li>
<li><p>a <em>validation sample</em> to validate the estimated
heterogeneity.</p></li>
</ol>
<p>We explore two distinct models for CATE estimation: a T-learner
employing honest regression forests as base learners, and an honest
causal forest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Sample split.</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">X_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">D_tr</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">D_val</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Y_tr</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">Y_val</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## CATEs estimation.</span></span>
<span><span class="co"># T-learner.</span></span>
<span><span class="va">forest_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/regression_forest.html" class="external-link">regression_forest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">Y_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">forest_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/regression_forest.html" class="external-link">regression_forest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span>, <span class="va">Y_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cates_val_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest_treated</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest_control</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> </span>
<span></span>
<span><span class="co"># Causal forest.</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html" class="external-link">causal_forest</a></span><span class="op">(</span><span class="va">X_tr</span>, <span class="va">Y_tr</span>, <span class="va">D_tr</span><span class="op">)</span> </span>
<span><span class="va">cates_val_cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> </span></code></pre></div>
<p>Let‚Äôs display the distribution of the out-of-sample CATE predictions.
Observing the histograms below, one might infer the presence of
heterogeneity in the treatment effects. However, substantial variation
in predictions does not definitively indicate heterogeneous effects, as
this variation may be attributed to <strong>estimation noise messing
with our results</strong> (precisely what is occurring in our
example!).</p>
<p>These complexities arise because the application of machine learning
tools to estimate heterogeneous treatment effects may produce
low-quality CATE estimates (see, e.g., the figure below, where we
compare true and estimated CATEs). It is therefore crucial to employ
appropriate procedures to validate the estimated CATE models and assess
whether systematic heterogeneity is detected. This is the purpose of the
<code>valiCATE</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Out-of-sample predicted CATEs.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"cates"</span> <span class="op">=</span> <span class="va">cates_val_t</span>, <span class="st">"estimator"</span> <span class="op">=</span> <span class="st">"T-learner"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"cates"</span> <span class="op">=</span> <span class="va">cates_val_cf</span>, <span class="st">"estimator"</span> <span class="op">=</span> <span class="st">"CF"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cates</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"dodgerblue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">estimator</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T-learner"</span>, <span class="st">"CF"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Estimated CATEs"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## True and estimated CATEs.</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"x1"</span> <span class="op">=</span> <span class="va">X_val</span>, <span class="st">"true_cates"</span> <span class="op">=</span> <span class="va">mu1</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span>, <span class="st">"cates_t"</span> <span class="op">=</span> <span class="va">cates_val_t</span>, <span class="st">"cates_cf"</span> <span class="op">=</span> <span class="va">cates_val_cf</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">melt</span><span class="op">(</span>id.vars <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="st">"T-learner"</span>, <span class="st">"CF"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"pink4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"CATEs"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.40</span>, <span class="fl">0.18</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">'cm'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚Ñπ</span> Please use the `legend.position.inside` argument of `theme()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span></span>
<span><span class="co">## Grid.</span></span>
<span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="valiCATE-short-tutorial_files/figure-html/cates-plot-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>The validation of the estimated CATE models focuses on three key
targets:</p>
<ul>
<li>Best Linear Predictor (BLP) of the actual CATEs using the estimated
CATEs;</li>
<li>Sorted Group Average Treatment Effects (GATES);</li>
<li>Rank-Weighted Average Treatment Effects (RATEs) induced by the
estimated CATEs.</li>
</ul>
<p>This section offers an overview of these targets. The discussion is
loosely based on Chernozhukov et al.¬†(2017), Yadlowsky et al.¬†(2021),
and Imai and Li (2022).<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Keep in mind that <strong>achieving valid inference necessitates a
training-validation sample split</strong>, akin to that performed in the
Motivating Example. Then, for any fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\tau} ( \cdot )</annotation></semantics></math>
obtained using only the training sample, our targets of interest are
estimated using observations solely from the validation sample.</p>
<div class="section level3">
<h3 id="best-linear-predictor">Best Linear Predictor<a class="anchor" aria-label="anchor" href="#best-linear-predictor"></a>
</h3>
<p>The BLP of the actual CATEs using the estimated CATEs is defined as
follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>L</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>:=</mo><msub><mi>Œ≤</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Œ≤</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex"> BLP [\tau ( X_i ) | \hat{\tau} ( X_i )] := \beta_1 + \beta_2 [ \hat{\tau} ( X_i ) - \mathbb{E} [ \hat{\tau} ( X_i ) ] ]</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mn>1</mn></msub><mo>=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_1 = \mathbb{E} [ \tau ( X_i ) ]</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mn>2</mn></msub><mo>=</mo><mi>C</mi><mi>o</mi><mi>v</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>/</mi><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_2 = Cov [ \tau ( X_i ), \hat{\tau} ( X_i ) ] / Var [ \hat{\tau} ( X_i ) ] = \mathbb{E} \left[ \frac{\hat{\tau} ( X_i ) - \mathbb{E} [\hat{\tau} ( X_i ) ]}{Var [ \hat{\tau} ( X_i ) ]} \tau ( X_i ) \right]</annotation></semantics></math>.</p>
<p>Our primary focus is on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\beta_2</annotation></semantics></math>.
Notice that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta_2 = 0</annotation></semantics></math>
if either <em>a)</em> the effects are homogeneous or <em>b)</em> our
CATE estimates are unreliable. Therefore, rejecting the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta_2 = 0</annotation></semantics></math>
would suggest both heterogeneous effects and reliable CATE estimates.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> As a
byproduct,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>
identifies the ATE.</p>
<p>The <code>valiCATE</code> package estimates the BLP using three
distinct strategies, each entailing the fitting of an appropriate
regression model.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<ul>
<li>
<strong>Weighted Residuals</strong>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Œ≤</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msub><mi>Œ≤</mi><mn>2</mn></msub><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>ùîº</mi><mi>n</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> Y_i = \beta_1 [ D_i - p ( X_i ) ] + \beta_2 \{ [ D_i - p ( X_i ) ] [ \hat{\tau} ( X_i ) - \mathbb{E}_n [ \hat{\tau} ( X_i ) ] ] \} + \epsilon_i </annotation></semantics></math>
with the model fitted via WLS using weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">w ( X_i)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùîº</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\mathbb{E}_n</annotation></semantics></math>
denoting the sample average operator.</p>
<ul>
<li><strong>Horvitz-Thompson</strong></li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>i</mi></msub><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Œ≤</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Œ≤</mi><mn>2</mn></msub><mo stretchy="false" form="prefix">{</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>ùîº</mi><mrow><mi>n</mi><mo>,</mo><mi>V</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> H_i Y_i = \beta_1 + \beta_2 \{ \hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} + \epsilon_i </annotation></semantics></math>
with the model fitted via OLS.</p>
<ul>
<li><strong>AIPW</strong></li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œì</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mo>=</mo><msub><mi>Œ≤</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Œ≤</mi><mn>2</mn></msub><mo stretchy="false" form="prefix">{</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>ùîº</mi><mrow><mi>n</mi><mo>,</mo><mi>V</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> \hat{\Gamma}_i = \beta_1 + \beta_2 \{ \hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} + \epsilon_i </annotation></semantics></math>
with the model fitted via OLS and the doubly-robust scores
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œì</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\Gamma_i</annotation></semantics></math>
constructed either via cross-fitting in the validation sample or using
the out-of-sample predictions of the nuisance models trained in the
training sample.</p>
</div>
<div class="section level3">
<h3 id="sorted-group-average-treatment-effects">Sorted Group Average Treatment Effects<a class="anchor" aria-label="anchor" href="#sorted-group-average-treatment-effects"></a>
</h3>
<p>The GATES are defined as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≥</mi><mi>k</mi></msub><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÑ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex"> \gamma_k := \mathbb{E} [ \tau ( X_i ) | \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ], \,\,\, k = 1, \dots, K</annotation></semantics></math></p>
<p>with the groups formed by cutting the distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\tau} ( \cdot )</annotation></semantics></math>
into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
bins using the empirical quantiles of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\tau} ( \cdot )</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><msubsup><mo stretchy="false" form="postfix">}</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup></mrow><annotation encoding="application/x-tex">\{ \hat{\ell}_k \}_{k = 1}^K</annotation></semantics></math>.</p>
<p>Our main objective is to test specific hypotheses regarding the
GATES, enabling us to determine whether we detect systematic
heterogeneity or merely estimation noise. For example, we can examine
whether all GATES are equal
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≥</mi><mn>1</mn></msub><mo>=</mo><msub><mi>Œ≥</mi><mn>2</mn></msub><mo>=</mo><mi>‚Ä¶</mi><mo>=</mo><msub><mi>Œ≥</mi><mi>K</mi></msub></mrow><annotation encoding="application/x-tex">\gamma_1 = \gamma_2 = \dots = \gamma_K</annotation></semantics></math>)
or if the difference between the largest and smallest GATES is zero
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≥</mi><mi>K</mi></msub><mo>=</mo><msub><mi>Œ≥</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\gamma_K = \gamma_1</annotation></semantics></math>).<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> As a
byproduct, the GATES quantify the degree to which effects vary across
groups, thus offering an immediate visualization of the estimated
heterogeneity *although disparities in the point estimates can emerge
merely due to estimation noise).</p>
<p>The <code>valiCATE</code> package estimates the GATES using four
different strategies, three of which involve fitting an appropriate
regression model, while the fourth relies on a nonparametric approach.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p><strong>Weighted Residuals</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>Œ≥</mi><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àí</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mn>ùüô</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> Y_i = \sum_{k = 1}^K \gamma_k [ D_i - p ( X_i ) ] \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) + \epsilon_i </annotation></semantics></math></p>
<p>with the model fitted via WLS using weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">w ( X_i)</annotation></semantics></math>.</p>
<p><strong>Horvitz-Thompson</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>i</mi></msub><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>Œ≥</mi><mi>k</mi></msub><mn>ùüô</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> H_i Y_i = \sum_{k = 1}^K \gamma_k \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) + \epsilon_i </annotation></semantics></math></p>
<p>with the model fitted via OLS.</p>
<p><strong>AIPW</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œì</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>Œ≥</mi><mi>k</mi></msub><mn>ùüô</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œµ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> \hat{\Gamma}_i = \sum_{k = 1}^K \gamma_k \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) + \epsilon_i </annotation></semantics></math></p>
<p>with the model fitted via OLS and the doubly-robust scores
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œì</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\Gamma_i</annotation></semantics></math>
constructed either via cross-fitting in the validation sample or using
the out-of-sample predictions of the nuisance models trained in the
training sample.</p>
<p><strong>Nonparametric</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œ≥</mi><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo>=</mo><mfrac><mi>K</mi><mrow><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>D</mi><mi>i</mi></msub></mrow></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>Y</mi><mi>i</mi></msub><msub><mi>D</mi><mi>i</mi></msub><mn>ùüô</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mfrac><mi>K</mi><mrow><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>‚àí</mo><msub><mi>D</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>‚àí</mo><msub><mi>D</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mn>ùüô</mn><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>‚â§</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mover><mo>‚Ñì</mo><mo accent="true">ÃÇ</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \hat{\gamma}_k = \frac{K}{\sum_{i = 1}^n D_i} \sum_{i = 1}^n Y_i D_i \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) - \frac{K}{\sum_{i = 1}^n [ 1 - D_i ]} \sum_{i = 1}^n Y_i [ 1 - D_i ] \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) </annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="rank-weighted-average-treatment-effects">Rank-Weighted Average Treatment Effects<a class="anchor" aria-label="anchor" href="#rank-weighted-average-treatment-effects"></a>
</h3>
<p>The RATE induced by the estimated CATEs is defined as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><msubsup><mo>‚à´</mo><mn>0</mn><mn>1</mn></msubsup><mi>Œ±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi><mi>O</mi><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>;</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>u</mi></mrow><annotation encoding="application/x-tex"> \theta_{\alpha} ( \hat{\tau} ) := \int_0^1 \alpha ( u ) TOC ( u; \hat{\tau} ) d u  </annotation></semantics></math>
where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>O</mi><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>;</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚â•</mo><mn>1</mn><mo>‚àí</mo><mi>u</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>‚àí</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex"> TOC (u; \hat{\tau}) := \mathbb{E} [ Y_i ( 1 ) - Y_i ( 0 ) \mid F ( \hat{\tau} ( X_i )) \geq 1 - u ] - \mathbb{E} [ Y_i ( 1 ) - Y_i ( 0 ) ] </annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F ( \cdot )</annotation></semantics></math>
the cumulative distribution function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\tau} ( \cdot )</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>u</mi><mo>‚â§</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 &lt; u \leq 1</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>:</mo><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">]</mo><mo>‚Üí</mo><mi>‚Ñõ</mi></mrow><annotation encoding="application/x-tex">\alpha : ( 0, 1 ] \rightarrow \mathcal{R}</annotation></semantics></math>
a generic weight function.</p>
<p>The RATE offers a measure of how effectively our estimated CATEs
prioritize units for treatment in terms of intervention benefit. The
concept involves considering
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\tau} ( \cdot )</annotation></semantics></math>
as a ‚Äúprioritization rule‚Äù that arranges units
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i = 1, ..., n</annotation></semantics></math>
in order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">j = 1, ..., n</annotation></semantics></math>
based on their estimated CATEs, such as by giving priority to units with
the largest estimated CATEs.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<p>Our primary focus is to test the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta_{\alpha} ( \hat{\tau} ) = 0</annotation></semantics></math>,
which holds true if either <em>a)</em> the effects are homogeneous or
<em>b)</em> our CATE estimates are unreliable. Thus, rejecting the
hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta_{\alpha} ( \hat{\tau} ) = 0</annotation></semantics></math>
would indicate both heterogeneous effects and reliable CATE estimates.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>The <code>valiCATE</code> package estimates the TOCs and the RATE
using the following sample-averaging estimators:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mrow><mi>T</mi><mi>O</mi><mi>C</mi></mrow><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>;</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mo stretchy="false" form="prefix">‚åä</mo><mi>u</mi><mi>n</mi><mo stretchy="false" form="postfix">‚åã</mo></mrow></mfrac><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mrow><mo stretchy="false" form="prefix">‚åä</mo><mi>u</mi><mi>n</mi><mo stretchy="false" form="postfix">‚åã</mo></mrow></munderover><msub><mover><mi>Œì</mi><mo accent="true">ÃÇ</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>‚àí</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mover><mi>Œì</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub></mrow><annotation encoding="application/x-tex"> \widehat{TOC} ( u; \hat{\tau} ) = \frac{1}{ \lfloor u n \rfloor } \sum_{j = 1}^{\lfloor u n \rfloor} \hat{\Gamma}_{i ( j )} - \frac{1}{n} \sum_{i = 1}^n \hat{\Gamma}_i </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œ∏</mi><mo accent="true">ÃÇ</mo></mover><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>Œ±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>j</mi><mi>n</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mover><mrow><mi>T</mi><mi>O</mi><mi>C</mi></mrow><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>j</mi><mi>n</mi></mfrac><mo>;</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \hat{\theta}_{\alpha} ( \hat{\tau} ) = \frac{1}{n} \sum_{j = 1}^n \alpha \left( \frac{j}{n} \right) \widehat{TOC} \left( \frac{j}{n}; \hat{\tau} \right) </annotation></semantics></math>
where we let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">i ( j )</annotation></semantics></math>
be the mapping from rank
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
to unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">i ( 1 )</annotation></semantics></math>
returns the most-prioritized unit, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">i ( n )</annotation></semantics></math>
returns the least-prioritized unit) and the doubly-robust scores
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œì</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\Gamma_i</annotation></semantics></math>
are constructed either via cross-fitting in the validation sample or
using the out-of-sample predictions of the nuisance models trained in
the training sample.</p>
<p>The <code>valiCATE</code> package considers two distinct weighting
functions, each corresponding to a different RATE:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha ( u ) = 1</annotation></semantics></math>
‚Üí Area under the TOC curve (AUTOC)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">\alpha ( u ) = u</annotation></semantics></math>
‚Üí Qini coefficient (QINI)</li>
</ul>
<p>The half-sample bootstrap procedure is employed to estimate the
standard error of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œ∏</mi><mo accent="true">ÃÇ</mo></mover><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\theta}_{\alpha} ( \cdot )</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<div class="section level3">
<h3 id="calling-the-main-function">Calling the Main Function<a class="anchor" aria-label="anchor" href="#calling-the-main-function"></a>
</h3>
<p>To estimate the BLP, GATES, and RATEs, we use the
<code>valiCATE</code> function. When calling this function, we must
provide our sample using the first six arguments: <code>Y_tr</code> and
<code>Y_val</code> for the observed outcomes, <code>D_tr</code> and
<code>D_val</code> for the treatment assignment, and <code>X_tr</code>
and <code>X_val</code> for the covariates of units in the training and
validation subsamples. Furthermore, it is necessary to supply our CATE
predictions on the validation sample using the <code>cates_val</code>
argument. This argument should consist of a named list, with each
element storing a vector of CATE predictions produced by a specific
model. We can choose our preferred names for the elements, keeping in
mind that these names will be used to display and plot the results. We
have already defined most of the arguments mentioned in this paragraph
in our Motivating Example above. Below, we construct the
<code>cates_val</code> list that stores the out-of-sample predictions
produced by the T-learner and the causal forest.</p>
<p>The <code>valiCATE</code> function can implement all the BLP and
GATES estimation strategies outlined in the Validation section. Users
can choose their preferred strategies by controlling the
<code>strategies</code> argument. However, this choice has no impact on
RATEs estimation, which are always estimated using the sample-averaging
estimators discussed above. Furthermore, the nonparametric strategy for
GATES estimation is always implemented. Below, we opt to implement only
the weighted residuals and the horvitz-thompson strategies.</p>
<p>Users can choose to include the additional constructed covariates
discussed in footnotes 4 and 7 by controlling the <code>denoising</code>
argument. However, this choice does not impact RATEs estimation or the
results from the nonparametric GATES estimation strategy. Below, we
decide not to include any constructed covariate.</p>
<p>Specific nuisance functions are necessary to conduct the analysis
outlined in the Validation section. Users can provide predictions on the
validation sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p ( \cdot )</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu ( \cdot )</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_0 ( \cdot )</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_1 ( \cdot )</annotation></semantics></math>
using the optional arguments <code>pscore_val</code>,
<code>mu_val</code>, <code>mu0_val</code>, and <code>mu1_val</code>,
respectively. It is important to note that these predictions must be
generated by models estimated using only the training sample. If not
supplied by the user, these functions are internally estimated via
honest regression forests using only the training sample. In our
Motivating Example, we know the actual propensity score, which is
constant at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.4</mn><annotation encoding="application/x-tex">0.4</annotation></semantics></math>
for all units.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> We provide these values in the call below
and allow the function to internally estimate the other nuisances.</p>
<p>Finally, we have five additional optional arguments.
<code>n_groups</code> controls the number of groups formed for the GATES
analysis. <code>beneficial</code> specifies how to rank units for the
RATE estimation (according to either increasing or decreasing values of
the estimated CATEs). <code>n_boot</code> determines the number of
bootstrap replications used to estimate the standard error of the
estimated RATEs. <code>crossfit_dr</code> controls whether the
doubly-robust scores are constructed via cross-fitting in the validation
sample or using the out-of-sample predictions of the nuisance models
trained in the training sample. <code>verbose</code> controls whether
the <code>valiCATE</code> function should print progress status on the
console. Below, we use the default settings of 5 groups, where the
treatment is considered beneficial, 200 bootstrap replications, and
cross-fitting in the validation sample. We prevent the function from
printing progress updates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define arguments.</span></span>
<span><span class="va">cates_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"T-learner"</span> <span class="op">=</span> <span class="va">cates_val_t</span>,</span>
<span>                  <span class="st">"CF"</span> <span class="op">=</span> <span class="va">cates_val_cf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WR"</span>, <span class="st">"HT"</span><span class="op">)</span></span>
<span><span class="va">denoising</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span></span>
<span><span class="va">pscore_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y_val</span><span class="op">)</span><span class="op">)</span> <span class="co"># True propensity scores.</span></span>
<span></span>
<span><span class="co">## Call main function.</span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/valiCATE.html">valiCATE</a></span><span class="op">(</span><span class="va">Y_tr</span>, <span class="va">Y_val</span>, <span class="va">D_tr</span>, <span class="va">D_val</span>, <span class="va">X_tr</span>, <span class="va">X_val</span>, <span class="va">cates_val</span>, strategies <span class="op">=</span> <span class="va">strategies</span>, denoising <span class="op">=</span> <span class="va">denoising</span>, pscore_val <span class="op">=</span> <span class="va">pscore_val</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>The <code>summary</code> method enables us to visualize the results
of the BLP estimation when we set the <code>target</code> argument to
BLP. The <code>latex</code> argument determines whether the raw results
or LATEX code for a table will be displayed in the console.
Additionally, we can use the <code>which_models</code> argument to
select which results to display, which is useful to avoid a lengthy
output. Since we have estimated a small number of models, we opt for the
default option and display all results.</p>
<p>We consistently fail to reject the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta_2 = 0</annotation></semantics></math>,
suggesting that either the effects are homogeneous or our CATE estimates
are unreliable (both are true in our Motivating Example). Given our
knowledge of the DGP, the results indicate that both models produce
unreliable estimates. Overall, the BLP analysis suggests that the
heterogeneity implied by the distribution of the estimated CATEs might
be merely estimation noise.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## BLP summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"BLP"</span><span class="op">)</span> <span class="co"># Try 'latex = TRUE'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚îÄ‚îÄ</span> <span style="font-weight: bold;">BLP RESULTS</span> <span style="color: #00BBBB;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">T-learner</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       MODEL       |       ATE       |       HET       </span></span>
<span><span class="co">#&gt; ----------------- | --------------- | --------------- | </span></span>
<span><span class="co">#&gt;      wr_none      |       0.45      |      -0.37      | </span></span>
<span><span class="co">#&gt;                   | [-0.117, 1.009] | [-1.325, 0.583] | </span></span>
<span><span class="co">#&gt;      ht_none      |       0.47      |      -0.41      | </span></span>
<span><span class="co">#&gt;                   | [-0.118, 1.057] | [-1.398, 0.581] |</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">CF</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt;       MODEL       |       ATE       |       HET       </span></span>
<span><span class="co">#&gt; ----------------- | --------------- | --------------- | </span></span>
<span><span class="co">#&gt;      wr_none      |       0.44      |      -0.66      | </span></span>
<span><span class="co">#&gt;                   | [-0.121, 1.006] | [-1.888, 0.563] | </span></span>
<span><span class="co">#&gt;      ht_none      |       0.47      |      -0.73      | </span></span>
<span><span class="co">#&gt;                   | [-0.118, 1.056] | [-2.017, 0.562] |</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span></span></code></pre></div>
<p>We can call the <code>summary</code> method with the
<code>target</code> argument set to GATES to visualize the results of
the GATES hypotheses testing, with the other arguments functioning as
before. To visualize GATES point estimates and confidence intervals, we
can call the <code>plot</code> method and set the <code>target</code>
argument to GATES. Similarly to the <code>summary</code> method, we
could utilize the <code>which_models</code> argument to select which
results to display, although it is not necessary in this context.</p>
<p>Almost all GATES confidence intervals encompass zero, indicating that
no group is affected by the treatment (true in our Motivating Example!).
The estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
for testing the hypotheses that all GATES are equal and that the most
and least affected groups exhibit the same response to treatment are
large, resulting in a failure to reject these hypotheses. This GATES
analysis offers additional evidence that the effects are not
heterogeneous.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## GATES summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span> <span class="co"># Try 'latex = TRUE'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚îÄ‚îÄ</span> <span style="font-weight: bold;">HYPOTHESIS TESTING RESULTS (p-values)</span> <span style="color: #00BBBB;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">T-learner</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       MODEL       |       GATES_1 = GATES_2 = ... = GATES_K       |       GATES_K = GATES_1       </span></span>
<span><span class="co">#&gt; ----------------- | --------------------------------------------- | ----------------------------- | </span></span>
<span><span class="co">#&gt;      wr_none      |                     0.895                     |             0.659             | </span></span>
<span><span class="co">#&gt;      ht_none      |                     0.895                     |             0.617             | </span></span>
<span><span class="co">#&gt;      imai_li      |                     0.935                     |               NA              |</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">CF</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt;       MODEL       |       GATES_1 = GATES_2 = ... = GATES_K       |       GATES_K = GATES_1       </span></span>
<span><span class="co">#&gt; ----------------- | --------------------------------------------- | ----------------------------- | </span></span>
<span><span class="co">#&gt;      wr_none      |                     0.640                     |             0.489             | </span></span>
<span><span class="co">#&gt;      ht_none      |                     0.586                     |             0.460             | </span></span>
<span><span class="co">#&gt;      imai_li      |                     0.641                     |               NA              |</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span></span></code></pre></div>
<p><img src="valiCATE-short-tutorial_files/figure-html/gates-results-1.png" width="480"></p>
<p>Lastly, calling the <code>summary</code> method with the
<code>target</code> argument set to RATE enables us to visualize the
results of the RATE estimation. To plot the estimated TOC curve, we can
call the <code>plot</code> method and set the <code>target</code>
argument to TOC. The AUTOC coefficient corresponds to the area under the
TOC curve, while the QINI coefficient corresponds to the area under the
curve
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>√ó</mo><mi>T</mi><mi>O</mi><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>;</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">u \times TOC (u; \hat{\tau})</annotation></semantics></math>.</p>
<p>Overall, the results align with those of the BLP analysis. We
consistently fail to reject the hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mi>Œ±</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\theta_{\alpha} ( \hat{\tau} ) = 0</annotation></semantics></math>,
suggesting that either the effects are homogeneous or our CATE estimates
are unreliable. Given our knowledge of the DGP, the results indicate
that both models produce unreliable estimates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## RATEs summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"RATE"</span><span class="op">)</span> <span class="co"># Try 'latex = TRUE'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚îÄ‚îÄ</span> <span style="font-weight: bold;">RATEs RESULTS</span> <span style="color: #00BBBB;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">T-learner</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       WEIGHT       |       RATE       | </span></span>
<span><span class="co">#&gt; ------------------ | ---------------- |  </span></span>
<span><span class="co">#&gt;        autoc       |       0.02       | </span></span>
<span><span class="co">#&gt;                    |  [-0.455, Infty] | </span></span>
<span><span class="co">#&gt;        qini        |       0.00       | </span></span>
<span><span class="co">#&gt;                    |  [-0.150, Infty] |</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ <span style="font-weight: bold;">CF</span> ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt;       WEIGHT       |       RATE       | </span></span>
<span><span class="co">#&gt; ------------------ | ---------------- |  </span></span>
<span><span class="co">#&gt;        autoc       |       -0.12      | </span></span>
<span><span class="co">#&gt;                    |  [-0.544, Infty] | </span></span>
<span><span class="co">#&gt;        qini        |       -0.02      | </span></span>
<span><span class="co">#&gt;                    |  [-0.157, Infty] |</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"TOC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="valiCATE-short-tutorial_files/figure-html/rates-results-1.png" width="480"></p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Complete references to these papers are listed in the <a href="https://riccardo-df.github.io/valiCATE/">home page</a>.<a href="#fnref1" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Failing to reject this hypothesis suggests either there
is no heterogeneity or our CATE estimates are not reliable. Without
further evidence, we cannot disentangle this ambiguity. Check the <a href="https://riccardo-df.github.io/valiCATE/articles/hypotheses-testing.html">hypotheses
testing vignette</a> for more details.<a href="#fnref2" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn3"><p>The linear regressions are used for estimation purposes.
The identification hinges on linear projections defined at the
population level, with the linear regressions constituting their sample
analogs.<a href="#fnref3" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn4"><p>For each of these alternatives, additional constructed
covariates not necessary for identifying the targets can be included in
the regressions to reduce estimation variance. Details can be found in
the <a href="https://riccardo-df.github.io/valiCATE/articles/denoising.html">denoising
vignette</a>.<a href="#fnref4" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn5"><p>Check the <a href="https://riccardo-df.github.io/valiCATE/articles/hypotheses-testing.html">hypotheses
testing vignette</a> for details.<a href="#fnref5" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn6"><p>See footnote 3.<a href="#fnref6" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn7"><p>For each of the parametric alternatives, additional
constructed covariates not necessary for identifying the targets can be
included in the regressions to reduce estimation variance. Details can
be found in the <a href="https://riccardo-df.github.io/valiCATE/articles/denoising.html">denoising
vignette</a>.<a href="#fnref7" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn8"><p>If the treatment is harmful, we prioritize units with
the lowest estimated CATEs.<a href="#fnref8" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn9"><p>Prioritization rules can be derived from alternatives
approaches, such as risk-based rules. However, our focus here is on
CATE-based rules, as we intend to utilize the RATEs to valdiate our
estimated CATE models.<a href="#fnref9" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn10"><p>See footnote 2.<a href="#fnref10" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn11"><p>It is important to note that most methodologies
implemented here are valid only under randomized experiments, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p ( \cdot )</annotation></semantics></math>
is known. The only exception is the AIPW strategy, which is valid under
unconfoundedness.<a href="#fnref11" class="footnote-back">‚Ü©Ô∏é</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Riccardo Di Francesco.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
