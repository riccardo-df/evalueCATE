<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CATEs Validation — valiCATE • valiCATE</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="CATEs Validation — valiCATE"><meta property="og:description" content="Validates CATE models by estimating the best linear predictor (BLP) of the actual CATEs using the estimated
CATEs, the sorted group average treatment effects (GATES), and the rank-weighted average treatment effects (RATEs) induced by
the estimated CATEs."><meta property="og:image" content="https://riccardo-df.github.io/valiCATE/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">valiCATE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/valiCATE-short-tutorial.html">Short Tutorial</a>
</li>
<li>
  <a href="../articles/denoising.html">Denoising</a>
</li>
<li>
  <a href="../articles/hypotheses-testing.html">Hypotheses Testing</a>
</li>
<li>
  <a href="../articles/more-on-plotting.html">More on Plotting</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/riccardo-df/valiCATE" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>CATEs Validation</h1>
    <small class="dont-index">Source: <a href="https://github.com/riccardo-df/evaluCATE/blob/main/R/valiCATE.R" class="external-link"><code>R/valiCATE.R</code></a></small>
    <div class="hidden name"><code>valiCATE.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Validates CATE models by estimating the best linear predictor (BLP) of the actual CATEs using the estimated
CATEs, the sorted group average treatment effects (GATES), and the rank-weighted average treatment effects (RATEs) induced by
the estimated CATEs.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">valiCATE</span><span class="op">(</span></span>
<span>  <span class="va">Y_tr</span>,</span>
<span>  <span class="va">Y_val</span>,</span>
<span>  <span class="va">D_tr</span>,</span>
<span>  <span class="va">D_val</span>,</span>
<span>  <span class="va">X_tr</span>,</span>
<span>  <span class="va">X_val</span>,</span>
<span>  <span class="va">cates_val</span>,</span>
<span>  strategies <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WR"</span>, <span class="st">"HT"</span>, <span class="st">"AIPW"</span><span class="op">)</span>,</span>
<span>  denoising <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"cddf1"</span>, <span class="st">"cddf2"</span>, <span class="st">"mck1"</span>, <span class="st">"mck2"</span>, <span class="st">"mck3"</span><span class="op">)</span>,</span>
<span>  pscore_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mu_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mu0_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mu1_val <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_groups <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  beneficial <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_boot <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  crossfit_dr <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-y-tr">Y_tr<a class="anchor" aria-label="anchor" href="#arg-y-tr"></a></dt>
<dd><p>Observed outcomes for the training sample.</p></dd>


<dt id="arg-y-val">Y_val<a class="anchor" aria-label="anchor" href="#arg-y-val"></a></dt>
<dd><p>Observed outcomes for the validation sample.</p></dd>


<dt id="arg-d-tr">D_tr<a class="anchor" aria-label="anchor" href="#arg-d-tr"></a></dt>
<dd><p>Treatment indicator for the training sample.</p></dd>


<dt id="arg-d-val">D_val<a class="anchor" aria-label="anchor" href="#arg-d-val"></a></dt>
<dd><p>Treatment indicator for the validation sample.</p></dd>


<dt id="arg-x-tr">X_tr<a class="anchor" aria-label="anchor" href="#arg-x-tr"></a></dt>
<dd><p>Covariate matrix for the training sample (no intercept).</p></dd>


<dt id="arg-x-val">X_val<a class="anchor" aria-label="anchor" href="#arg-x-val"></a></dt>
<dd><p>Covariate matrix for the validation sample (no intercept).</p></dd>


<dt id="arg-cates-val">cates_val<a class="anchor" aria-label="anchor" href="#arg-cates-val"></a></dt>
<dd><p>Named list storing CATE predictions on the validation sample produced by different models. Models must be estimated using only the training sample.</p></dd>


<dt id="arg-strategies">strategies<a class="anchor" aria-label="anchor" href="#arg-strategies"></a></dt>
<dd><p>Character vector controlling the identification and estimation strategies to implement for BLP and GATES. Admitted values are <code>"WR"</code>, <code>"HT"</code>, and <code>"AIPW"</code>.</p></dd>


<dt id="arg-denoising">denoising<a class="anchor" aria-label="anchor" href="#arg-denoising"></a></dt>
<dd><p>Character vector controlling if and which additional covariates to include in the regressions for BLP and GATES to reduce the variance of the estimation. Admitted values are <code>"none"</code>, <code>"cddf1"</code>, <code>"cddf2"</code>, <code>"mck1"</code>, <code>"mck2"</code>, and <code>"mck3"</code>.</p></dd>


<dt id="arg-pscore-val">pscore_val<a class="anchor" aria-label="anchor" href="#arg-pscore-val"></a></dt>
<dd><p>Propensity score predictions on the validation sample. Must be produced by a model estimated using only the training sample (unless the propensity score is known, in which case we provide the true values).</p></dd>


<dt id="arg-mu-val">mu_val<a class="anchor" aria-label="anchor" href="#arg-mu-val"></a></dt>
<dd><p>Conditional mean predictions on the validation sample. Must be produced by a model estimated using only the training sample.</p></dd>


<dt id="arg-mu-val">mu0_val<a class="anchor" aria-label="anchor" href="#arg-mu-val"></a></dt>
<dd><p>Control units' conditional mean predictions on the validation sample. Must be produced by a model estimated using only the training sample.</p></dd>


<dt id="arg-mu-val">mu1_val<a class="anchor" aria-label="anchor" href="#arg-mu-val"></a></dt>
<dd><p>Treated units' conditional mean predictions on the validation sample. Must be produced by a model estimated using only the training sample.</p></dd>


<dt id="arg-n-groups">n_groups<a class="anchor" aria-label="anchor" href="#arg-n-groups"></a></dt>
<dd><p>Number of groups to be formed for the GATES analysis.</p></dd>


<dt id="arg-beneficial">beneficial<a class="anchor" aria-label="anchor" href="#arg-beneficial"></a></dt>
<dd><p>Logical, whether the treatment is beneficial to units. If <code>TRUE</code>, units are ranked according to decreasing values of <code>cates_val</code> to estimate the RATEs, otherwise they are ranked according to increasing values of <code>cates_val</code>.</p></dd>


<dt id="arg-n-boot">n_boot<a class="anchor" aria-label="anchor" href="#arg-n-boot"></a></dt>
<dd><p>Number of bootstrap replications to estimate the standard error of the RATE estimates.</p></dd>


<dt id="arg-crossfit-dr">crossfit_dr<a class="anchor" aria-label="anchor" href="#arg-crossfit-dr"></a></dt>
<dd><p>Logical, whether the doubly-robust scores should be cross-fitted in the validation sample. If <code>FALSE</code>, the scores are constructed using the out-of-sample predictions from the nuisance models trained in the training sample.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, set to FALSE to prevent the function from printing the progresses.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An <code>valiCATE</code> object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The user must provide observations on the outcomes, the treatment status, and the covariates of units in the training and validation samples separately
using the first six arguments. The user must also provide a named list storing CATE predictions on the validation sample produced from different models (the Example section below shows how to construct such a list).
Be careful, CATE models must be estimated using only the training sample to achieve valid inference.<br></p>
<p>The <code>valiCATE</code> function allows the implementation of three different strategies for BLP and GATES identification and estimation: a) Weighted Residuals (WR), Horwitz-Thompson (HT), and
Augmented Inverse-Probability Weighting (AIPW). The user can choose their preferred strategies by controlling the <code>strategies</code> argument. This has no impact on RATEs estimation. GATES are also
always estimated using an additional nonparametric approach.<br></p>
<p>Most of the BLP and GATES estimation strategies involve fitting a suitable linear model. For each model, there exist various sets of constructed covariates that one can add to reduce the variance of
the estimation. The user can choose whether to add these additional covariates by controlling the <code>denoising</code> argument (check the online
<a href="https://riccardo-df.github.io/valiCATE/articles/denoising.html">denoising vignette</a> for details). This has no impact on RATEs estimation and on the results from the nonparametric GATES estimation strategy.</p>
<p>The constructed covariates depend on particular nuisance functions, e.g., propensity score and conditional mean of the outcome. The user can supply predictions on the validation sample of these functions
by using the  optional arguments <code>pscore_val</code>, <code>mu_val</code>, <code>mu0_val</code>, and <code>mu1_val</code>. Be careful, as these predictions must be produced by models fitted using only the training sample. If not
provided by the user, these functions are estimated internally via honest <code><a href="https://rdrr.io/pkg/grf/man/regression_forest.html" class="external-link">regression_forest</a></code>s using only the training sample. <br></p>
<p>For the linear models, standard errors are estimated using the Eicker-Huber-White estimator. Under our careful sample splitting procedure, these standard errors can then used to test various
hypotheses of effect heterogeneity. For the GATES, we focus on two distinct hypotheses: whether all GATES are equal to each other, and whether the largest and the smallest GATES are different from each other.
The nonparametric approach tests only the first of these hypotheses. Check the <a href="https://riccardo-df.github.io/valiCATE/articles/hypotheses-testing.html">hypotheses testing vignette</a>
for details.<br></p>
<p>To estimate the BLP and GATES using the AIPW strategy, doubly-robust scores are estimated internally in one of two ways: if <code>crossfit_dr</code> is <code>TRUE</code>, we use
the validation sample and 5-fold cross fitting with honest regression forests (see the
<code><a href="https://riccardo-df.github.io/aggTrees/reference/dr_scores.html" class="external-link">dr_scores</a></code> function for details), while if <code>crossfit_dr</code> is <code>FALSE</code>, we use the out-of-sample predictions from the nuisance models trained
using the training sample. The doubly-robust scores are also used to estimate the RATEs.<br></p>
<p>Groups for the GATES analysis are constructed by cutting the distribution of <code>cates_val</code> into <code>n_groups</code> quantiles. If this leads to one or more groups composed of only treated or only control units,
the function raises an error. Possible solutions include: a) change your original training-validation sample split; b) increase the fraction of observations allocated to the validation sample.<br></p>
<p>The <code>valiCATE</code> function estimates two different RATEs: AUTOC and QINI coefficients. Sample-averaging estimators are employed. Standard errors are estimated by the standard deviation of the bootstrap
estimates obtained using the half-sample bootstrap.<br></p>
<p>Check the online <a href="https://riccardo-df.github.io/valiCATE/articles/valiCATE-short-tutorial.html">short tutorial</a> for a guided usage of this function.<br></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Riccardo Di Francesco</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Generate data.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">mu0</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sample split.</span></span></span>
<span class="r-in"><span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">X_tr</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">X_val</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">D_tr</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">D_val</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Y_tr</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">Y_val</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## CATEs estimation. Models are estimated with training sample.</span></span></span>
<span class="r-in"><span><span class="co"># T-learner.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grf-labs/grf" class="external-link">grf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">forest_treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/regression_forest.html" class="external-link">regression_forest</a></span><span class="op">(</span><span class="va">X_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, <span class="va">Y_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">forest_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/regression_forest.html" class="external-link">regression_forest</a></span><span class="op">(</span><span class="va">X_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>, <span class="va">Y_tr</span><span class="op">[</span><span class="va">D_tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cates_val_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest_treated</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest_control</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Grf.</span></span></span>
<span class="r-in"><span><span class="va">forest_grf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html" class="external-link">causal_forest</a></span><span class="op">(</span><span class="va">X_tr</span>, <span class="va">Y_tr</span>, <span class="va">D_tr</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">cates_val_grf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest_grf</span>, <span class="va">X_val</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## CATEs validation. </span></span></span>
<span class="r-in"><span><span class="co"># Use all strategies with no denoising.</span></span></span>
<span class="r-in"><span><span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WR"</span>, <span class="st">"HT"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">denoising</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We know true pscore.</span></span></span>
<span class="r-in"><span><span class="va">pscore_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y_val</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Construct CATEs list.</span></span></span>
<span class="r-in"><span><span class="va">cates_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"T-learner"</span> <span class="op">=</span> <span class="va">cates_val_t</span>,</span></span>
<span class="r-in"><span>                  <span class="st">"grf"</span> <span class="op">=</span> <span class="va">cates_val_grf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Call main function.</span></span></span>
<span class="r-in"><span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu">valiCATE</span><span class="op">(</span><span class="va">Y_tr</span>, <span class="va">Y_val</span>, <span class="va">D_tr</span>, <span class="va">D_val</span>, <span class="va">X_tr</span>, <span class="va">X_val</span>, <span class="va">cates_val</span>, </span></span>
<span class="r-in"><span>                        strategies <span class="op">=</span> <span class="va">strategies</span>, denoising <span class="op">=</span> <span class="va">denoising</span>, </span></span>
<span class="r-in"><span>                        pscore_val <span class="op">=</span> <span class="va">pscore_val</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimating nuisance functions and DR scores; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BLP estimation; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GATES estimation; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RATE estimation; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Output. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Generic S3 methods.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"BLP"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">BLP RESULTS</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">T-learner</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       MODEL       |       ATE       |       HET       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------- | --------------- | --------------- | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      wr_none      |      -0.12      |       1.05      | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   | [-0.333, 0.089] |  [0.811, 1.299] | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ht_none      |      -0.14      |       1.07      | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   | [-0.363, 0.086] |  [0.791, 1.345] | </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">grf</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       MODEL       |       ATE       |       HET       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------- | --------------- | --------------- | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      wr_none      |      -0.12      |       1.06      | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   | [-0.331, 0.090] |  [0.810, 1.305] | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ht_none      |      -0.14      |       1.06      | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   | [-0.363, 0.086] |  [0.783, 1.338] | </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"BLP"</span>, latex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> \begingroup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     \setlength{\tabcolsep}{8pt}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     \renewcommand{\arraystretch}{1.1}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     \begin{table}[H]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \centering</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \begin{adjustbox}{width = 1\textwidth}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \begin{tabular}{@{\extracolsep{5pt}}l c c c c}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \\[-1.8ex]\hline</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \hline \\[-1.8ex]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &amp; \multicolumn{2}{c}{\textit{T-learner}} &amp;  \multicolumn{2}{c}{\textit{grf}}  \\ \cmidrule{2-3} \cmidrule{4-5} </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &amp; \textit{WR} &amp;  \textit{HT} &amp;\textit{WR} &amp;  \textit{HT}  \\</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \addlinespace[2pt]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \hline \\[-1.8ex] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \multirow{2}{6em}{ATE ($\hat{\beta}_1$)} &amp; -0.12 &amp;  -0.14 &amp;  -0.12 &amp;  -0.14 \\ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &amp; [-0.333, 0.089] &amp;  [-0.363, 0.086] &amp;  [-0.331, 0.090] &amp;  [-0.363, 0.086] \\ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \multirow{2}{6em}{HET ($\hat{\beta}_2$)} &amp; 1.05 &amp;  1.07 &amp;  1.06 &amp;  1.06 \\ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &amp; [0.811, 1.299] &amp;  [0.791, 1.345] &amp;  [0.810, 1.305] &amp;  [0.783, 1.338] \\ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \addlinespace[3pt]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \\[-1.8ex]\hline</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \hline \\[-1.8ex]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \end{tabular}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \end{adjustbox}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \caption{BLP results. $95\%$ confidence intervals are displayed in brackets under each point estimate.}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       \label{table_blp_results}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     \end{table}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> \endgroup</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">HYPOTHESIS TESTING RESULTS (p-values)</span> <span style="color: #00BBBB;">───────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">T-learner</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       MODEL       |       GATES_1 = GATES_2 = ... = GATES_K       |       GATES_K = GATES_1       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------- | --------------------------------------------- | ----------------------------- | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      wr_none      |                     0.000                     |             0.000             | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ht_none      |                     0.000                     |             0.000             | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      imai_li      |                     0.000                     |               NA              | </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">grf</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       MODEL       |       GATES_1 = GATES_2 = ... = GATES_K       |       GATES_K = GATES_1       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------- | --------------------------------------------- | ----------------------------- | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      wr_none      |                     0.000                     |             0.000             | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ht_none      |                     0.000                     |             0.000             | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      imai_li      |                     0.000                     |               NA              | </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────────────────────────</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"GATES"</span>, latex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NOT IMPLEMENTED, AS WE FEEL ANY TABLE WOULD BE MESSY. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WE APPRECIATE ANY SUGGESTIONS ON NICE FORMATS YOU WOULD LIKE TO HAVE :) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAY WE SUGGEST TO USE THE PRINT METHOD TO PRODUCE A NICE PLOT? </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"RATE"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">RATEs RESULTS</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">T-learner</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       WEIGHT       |       RATE       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------ | ---------------- |  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        autoc       |       0.89       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    |  [0.713, Infty]  | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        qini        |       0.28       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    |  [0.233, Infty]  | </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">grf</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       WEIGHT       |       RATE       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------ | ---------------- |  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        autoc       |       0.88       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    |  [0.711, Infty]  | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        qini        |       0.28       | </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    |  [0.229, Infty]  | </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"RATE"</span>, latex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> YET TO BE IMPLEMENTED, SORRY :( </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WE APPRECIATE ANY SUGGESTIONS ON THE FORMAT. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAY WE SUGGEST TO USE THE PRINT METHOD TO PRODUCE A NICE PLOT FOR THE TOCs?</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="valiCATE-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"TOC"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="valiCATE-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span>, target <span class="op">=</span> <span class="st">"RATE"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="valiCATE-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Riccardo Di Francesco.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

